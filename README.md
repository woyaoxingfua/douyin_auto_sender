# 抖音PC客户端 - 每日天气助手-自动续火花 (v4.5)

本项目是一个基于 Python 的桌面UI自动化工具，旨在每日定时向指定的抖音好友发送其所在城市的天气预报。它通过结合和风天气API、图形用户界面(GUI)配置工具以及 PyAutoGUI 库实现全自动化操作。

##  主要功能

  * **全自动流程**: 自动获取天气、打开抖音、查找好友、发送消息、退出会话，实现多好友循环处理。
  * **图形化配置后台**: 提供一个用户友好的GUI界面 (`config_manager_gui.py`)，可轻松添加、更新、删除好友及其城市信息，无需修改代码。
  * **内置城市ID查询**: 在GUI中直接集成和风天气城市查询功能，通过中文名即可精确查找并关联`Location ID`，确保天气查询的准确性。
  * **智能滚动与定位**: 采用"锚点定位+鼠标拖动"的稳定方式来滚动好友列表，解决了在复杂界面中UI焦点不正确导致滚动失效的问题。
  * **中文输入解决方案**: 通过系统剪贴板进行"复制/粘贴"操作，完美解决了`pyautogui`无法直接输入中文的限制。
  * **高度可配置**: 所有关键信息（API密钥、API域名、好友列表）均存储在外部`config.json`文件中，便于管理和迁移。

##  项目结构

```
douyin_auto_sender/

 config_manager_gui.py       # (入口1) 图形化配置工具
 douyin_bot.py               # (入口2) 自动化机器人主程序
 config.json                 # 配置文件 (由GUI生成，请勿手动修改)

 control_images/             # 存放UI控制按钮的截图
    douyin_sixin_icon.png
    douyin_send_button.png
    douyin_exit_chat_button.png
    douyin_scroll_bar.png

 friend_avatars/             # 存放好友头像的截图
     haoyou.png
     ... (其他好友头像)
```

## ️ 环境安装与配置

#### 1\. 软件依赖

  * **Python**: 建议使用 3.8 或更高版本。
  * **PyCharm**: 用于项目管理和编码。
  * **Tesseract-OCR**: 用于图像文字识别的底层引擎（在我们的项目中，`pyautogui`依赖它，但我们主要用图像识别）。

#### 2\. Python库安装

在PyCharm的终端(Terminal)中，运行以下命令以安装所有必需的Python库：

```bash
pip install pyautogui pillow pytesseract requests opencv-python pyperclip
```

##  使用指南

整个流程分为两步：先用GUI进行配置，再运行机器人程序。

#### **第一步：配置好友与API信息**

1.  **运行配置工具**: 在PyCharm中右键点击 `config_manager_gui.py` -> **Run 'config\_manager\_gui'**。
2.  **填写API信息**: 在弹出的窗口顶部，填入您从和风天气开发者平台获取的专属 **API Host** 和 **API Key**。
3.  **添加好友**:
      * 在"查找城市ID"区域，输入好友的城市中文名（如"项城"），点击 **"查询ID"**。
      * 在下方的结果列表中，**用鼠标点击选中**最准确的那条城市信息。
      * 在"编辑好友信息"区域，输入好友的**昵称**。
      * 点击 **"选择..."** 按钮，在弹出的窗口中进入 `friend_avatars` 文件夹，选择该好友的头像截图。
      * 点击 **"添加为新好友"** 按钮。
4.  **管理好友**:
      * 重复步骤3添加所有好友。
      * 如需修改，在左侧列表中选中好友，右侧信息会自动加载，修改后点击 **"更新选中好友"**。
      * 如需删除，选中后点击 **"删除选中好友"**。
5.  **保存配置**: 完成所有操作后，点击 **"️ 保存所有配置并退出"**。程序会自动生成或更新 `config.json` 文件。

#### **第二步：执行自动化任务**

1.  **准备截图**: 确保下文"所需截图素材"列表中的所有图片都已按要求截取并存放。
2.  **运行机器人**: 在PyCharm中右键点击 `douyin_bot.py` -> **Run 'douyin\_bot'**。
3.  **激活窗口**: 程序会开始10秒倒计时。在此期间，请**用鼠标点击一下抖音PC客户端的窗口**，确保它是当前最前方的活动应用。
4.  **任务开始**: 之后，请放开鼠标和键盘，静静观看机器人完成所有操作。

## ️ 所需截图素材 (重要！)

所有截图都应尽量精确，只包含目标图案，背景越少越好。

| 文件名                              | 存放文件夹          | 截图说明                  |
|:---------------------------------| :------------------ |:----------------------|
| `douyin_sixin_icon.png`          | `control_images/`   | 抖音主界面右上角的"私信"信封图标。    |
| `douyin_send_button.png`         | `control_images/`   | 聊天界面中的"发送"按钮。         |
| `douyin_exit_chat_button.png`    | `control_images/`   | 进入聊天界面后，右上角的"退出会话"按钮。 |
| `douyin_scroll_bar.png`          | `control_images/`   | 私信滚动条，用于滚动定位。         |
| `(例如 haoyou.png)`                | `friend_avatars/`   | 您要发送消息的每一位好友的头像截图。    |

##  注意事项

  * **截图精度**: 程序的识别成功率与您的截图精度直接相关。如果某个按钮找不到，请尝试重新截取。
  * **界面更新**: 如果抖音PC客户端版本更新，导致UI发生变化，您可能需要重新截取对应的控制图片。
  * **紧急停止**: 程序内置了`pyautogui.FAILSAFE`机制。在程序运行过程中，如果您想紧急停止，只需将鼠标指针**猛地移动到屏幕的左上角**即可。
  * **多屏幕**: 如果您使用多个显示器，请确保抖音客户端和PyCharm在同一个主显示器上运行，以避免坐标定位问题。

-----

*作者GitHub-https://github.com/woyaoxingfua*